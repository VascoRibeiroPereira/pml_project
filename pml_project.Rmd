---
title: "PML Project"
author: "Vasco Pereira"
date: "8/22/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Goals   
Predict the manner in which the subjects did the exercise, classified as the "classe" variable in the training set.
The report describes:
1 - How the model was built;
2 - How cross validation was used;
3 - The expected out of sample error;
4 - A walthrough of the made choices.

## Experimental Design   
Six participants performed barbell lifts while monitored by 4 accelerometers:
1 - belt
2 - forearm
3 - arm
4 - dumbbell


## Libraries

```{r }
library(caret)
```

## Exploratory Data Analysis

### Download Data

```{r, cache=TRUE}

# Download data
training <- read.csv(url("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-training.csv"), 
                     header = T)

testing <- read.csv(url("https://d396qusza40orc.cloudfront.net/predmachlearn/pml-testing.csv"), 
                     header = T)
```

Dimentions of the original data:
- training: `r dim(training)`
- testing: `r dim(testing)`

After downloading the data, it was observed a lot of missing values (it was made by the function `str()`) - not showned in this project.
So we will clean the data by removing the missing values by this approuch:
1 - turning missing values into **0**
2 - removing predictors with *near zero variance*

### Cleaning data

```{r, cache=TRUE}

# Turn NA into zero values
training[is.na(training)]<-0
testing[is.na(testing)]<-0 # applying the same transformation to the test set

# Getting near zero variance predictors for training set
nsv_training <- nearZeroVar(training)

# Removing the above predictors from both sets
training_Clean <- (training[,-nsv_training])
testing_Clean <- (testing[,-nsv_training]) # note that all the transformations are made due to the training set analysis

# Removing predictors that are not usefull for the analysis
training_Clean <- training_Clean[,-(1:6)]
testing_Clean <- testing_Clean[,-(1:6)] # applying the same transformation to the test set
```

So both training_Clean and testing_Clean had the same cleaning process and ended with this dimentions:
- training_Clean: `r dim(training_Clean)`
- testing_Clean: `r dim(testing_Clean)`




``` {r }
# subseting train data
set.seed(32323)
inTrain <- createDataPartition(y=training_Clean$classe,
                               p=.75,
                               list = F)

trainData <- training_Clean[inTrain, ]
testData <- training_Clean[-inTrain, ]

# creating a model with rf method and 5 fold cross validation on training

model <- train(classe ~ ., trainData, method = "rf", 
               trControl = trainControl(method = "cv", 
                                        number = 5, 
                                        verboseIter = T))

# testing the model on the test subset

predictions <- predict(model, testData)

# confusion matrix

cfMatrix <- confusionMatrix(predictions, testData$classe)

# Accuracy and Out of sample error
paste(round(as.numeric(cfMatrix$overall[1])*100, 2), "%", sep="")
paste(round(as.numeric(1-cfMatrix$overall[1])*100, 2), "%", sep="")

```